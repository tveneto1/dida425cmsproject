<!DOCTYPE html>
<html>
    <head>
        <!-- same thing as display, refresh every 24 sec, 
         see three announcements and then go back to display.html 
         *WORKS* -->
        <meta http-equiv="refresh" content="23; url={% url 'weather_view' %}"/>

        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
            
            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                background: white;
                margin: 0;
                padding: 40px;
                max-width: 1200px;
                margin: 0 auto;
            }
            
            h2 {
                color: #005A43;
                font-weight: 700;
                margin-bottom: 30px;
                font-size: 2em;
            }
            
            #jsonfile {
                background: #f8f9fa;
                padding: 30px;
                border-radius: 8px;
                border: 1px solid #dee2e6;
            }
            
            #jsonfile h3 {
                color: #005A43;
                margin-bottom: 15px;
                font-weight: 700;
                font-size: 1.5em;
            }
            
            #jsonfile p {
                color: #333;
                line-height: 1.8;
                font-size: 1.1em;
            }
            
            .category {
                display: inline-block;
                padding: 6px 15px;
                background: #005A43;
                color: white;
                border-radius: 4px;
                font-size: 14px;
                font-weight: 600;
                margin-bottom: 20px;
            }
        </style>
        
    </head>
    <body>
        <h2 style="text-align: center;">Dateline Announcements:</h2>
        
        <div id="jsonfile"></div>
        
        <script>
        // code and comments taken/adapted from tutorial:
        // https://happycoding.io/tutorials/javascript/fetch#json 
                
        async function fetchAnnounce() {
            // Fetch content using Django URL
            const fetchResponse = await fetch("{% url 'getjson' %}");
            // Read the JSON content of the response and parse it to get an array
            const messagesArray = await fetchResponse.json();
            // Pick random announcement
            const randomIndex = Math.floor(Math.random() * messagesArray.length);
            const announcement = messagesArray[randomIndex];
            // Use that message to set content
            const welcomeContainer = document.getElementById("jsonfile");
            welcomeContainer.innerHTML = `<h3>${announcement.title}</h3><p>${announcement.body}</p>`;
        }
        
        window.onload = fetchAnnounce();
        
        // to refresh the announcements automatically every 8 sec
        // https://www.geeksforgeeks.org/javascript/how-to-automatic-refresh-a-web-page-in-fixed-time/
        function autoRefresh() {
            fetchAnnounce(); // Just refresh the content, not the whole page
        }
        setInterval(autoRefresh, 8000);
    
        </script>
    </body>
</html>
