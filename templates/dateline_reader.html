<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="refresh" content="23; url={% url 'weather_view' %}"/>

        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
            
            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                background: white;
                margin: 0;
                padding: 40px;
                max-width: 1200px;
                margin: 0 auto;
            }
            
            h2 {
                color: #005A43;
                font-weight: 700;
                margin-bottom: 30px;
                font-size: 2em;
            }
            
            #jsonfile {
                background: #f8f9fa;
                padding: 30px;
                border-radius: 8px;
                border: 1px solid #dee2e6;
            }
            
            #jsonfile h3 {
                color: #005A43;
                margin-bottom: 15px;
                font-weight: 700;
                font-size: 1.5em;
            }
            
            #jsonfile p {
                color: #333;
                line-height: 1.8;
                font-size: 1.1em;
            }
            
            .category {
                display: inline-block;
                padding: 6px 15px;
                background: #005A43;
                color: white;
                border-radius: 4px;
                font-size: 14px;
                font-weight: 600;
                margin-bottom: 20px;
            }
        </style>
        
    </head>
    <body>
        <h2 style="text-align: center;">Dateline Announcements:</h2>
        
        <div id="jsonfile">Loading announcements...</div>
        
        <script>
        async function fetchAnnounce() {
            try {
                const fetchResponse = await fetch("{% url 'getjson' %}");
                
                if (!fetchResponse.ok) {
                    throw new Error(`HTTP error! status: ${fetchResponse.status}`);
                }
                
                const messagesArray = await fetchResponse.json();
                
                if (messagesArray.length === 0) {
                    document.getElementById("jsonfile").innerHTML = '<p>No announcements available.</p>';
                    return;
                }
                
                // Pick random announcement
                const randomIndex = Math.floor(Math.random() * messagesArray.length);
                const announcement = messagesArray[randomIndex];
                
                // Display the announcement
                const welcomeContainer = document.getElementById("jsonfile");
                welcomeContainer.innerHTML = `
                    <span class="category">${announcement.category}</span>
                    <h3>${announcement.title}</h3>
                    <p>${announcement.body}</p>
                `;
                
            } catch (error) {
                console.error('Error fetching announcements:', error);
                document.getElementById("jsonfile").innerHTML = 
                    '<p style="color: red;">Error loading announcements.</p>';
            }
        }
        
        // Initial load
        window.onload = fetchAnnounce;
        
        // Auto-refresh every 8 seconds
        setInterval(fetchAnnounce, 8000);
        </script>
    </body>
</html>
